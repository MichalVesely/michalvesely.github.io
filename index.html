<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Address Checker – JSON schema verze</title>
  <style>
    :root {
      --brand: #2563eb; --bg: #f6f8fb; --card: #fff;
      --muted: #eef2f7; --muted-2: #e2e8f0;
      --ink: #0f172a; --shadow: 0 12px 40px rgba(2,8,23,.06);
      --r-lg: 1rem; --r-md: .75rem;
    }
    body {
      margin: 0; font-family: system-ui, sans-serif;
      background: var(--bg); color: var(--ink);
      display: grid; grid-template-rows: auto 1fr; gap: 1rem;
    }
    .topbar {
      background: var(--card); box-shadow: var(--shadow);
      padding: 1rem clamp(1rem, 3vw, 2rem);
      display: grid; gap: .5rem;
    }
    form { display: grid; grid-template-columns: 1fr auto; gap: .5rem; }
    input {
      padding: .8rem 1rem; border: 1px solid var(--muted-2);
      border-radius: var(--r-md); font-size: 1rem;
    }
    button {
      padding: .8rem 1rem; background: var(--brand); color: #fff;
      border: none; border-radius: var(--r-md); font-weight: bold;
      cursor: pointer;
    }
    .content { padding: 0 clamp(1rem, 3vw, 2rem) 2rem; }
    .grid { display: grid; gap: 1rem; grid-template-columns: repeat(auto-fit, minmax(280px,1fr)); }
    .card { background: var(--card); border-radius: var(--r-lg); box-shadow: var(--shadow); padding: 1rem; }
    .frame {
      background: var(--muted); border: 1px solid var(--muted-2);
      border-radius: var(--r-md); min-height: 220px;
      display: grid; place-items: center; overflow: hidden; position: relative;
    }
    .frame img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .skeleton::after {
      content: ""; position: absolute; inset: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.5), transparent);
      animation: shimmer 1.2s infinite; transform: translateX(-100%);
    }
    @keyframes shimmer { to { transform: translateX(100%); } }
    .section-title { margin-top: 1rem; font-weight: bold; color: var(--brand); }
    table { width: 100%; border-collapse: collapse; background: var(--muted); border-radius: .5rem; overflow: hidden; }
    th, td { padding: .4rem .6rem; border-bottom: 1px solid var(--muted-2); text-align: left; }
    th { background: #e0e7ef; width: 40%; }
    tr:last-child td { border-bottom: none; }
    .result, .error { padding: .8rem; border-radius: var(--r-md); margin-top: 1rem; }
    .result { background: var(--muted); }
    .error { background: #fee2e2; color: #7f1d1d; }
  </style>
</head>
<body>
  <div class="topbar">
    <h1>Address Checker</h1>
    <form id="form">
      <input id="address" type="text" placeholder="Např. Okružní 7, Řež" required />
      <button>Odeslat</button>
    </form>
  </div>

  <div class="content">
    <div id="status" class="result">Zadej adresu a odešlu ji na webhook.</div>
    <div id="images" class="grid" style="display:none;">
      <div class="card">
        <h3>Satelit</h3>
        <div class="frame skeleton" id="sat-frame"></div>
      </div>
      <div class="card">
        <h3>Street View</h3>
        <div class="frame skeleton" id="stv-frame"></div>
      </div>
      <div class="card">
        <h3>Katastr</h3>
        <div class="frame skeleton" id="kat-frame"></div>
      </div>
    </div>
    <div id="details"></div>
  </div>

  <script>
    const form = document.getElementById('form');
    const addressInput = document.getElementById('address');
    const statusEl = document.getElementById('status');
    const imagesEl = document.getElementById('images');
    const satFrame = document.getElementById('sat-frame');
    const stvFrame = document.getElementById('stv-frame');
    const katFrame = document.getElementById('kat-frame');
    const detailsEl = document.getElementById('details');

    form.addEventListener('submit', async e => {
      e.preventDefault();
      const adress = addressInput.value.trim();
      if(!adress) return;

      statusEl.textContent = 'Načítám...';
      imagesEl.style.display = 'grid';
      [satFrame, stvFrame, katFrame].forEach(f => { f.innerHTML=''; f.classList.add('skeleton'); });

      try {
        const res = await fetch('https://hook.eu2.make.com/t7uwl8n3si3xdvp17bi8dcs4toj4cpeh', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ adress })
        });
        if(!res.ok) throw new Error('Chyba komunikace s webhookem');
        const data = await res.json();

        // Obrázky z jasně definovaných klíčů
        mountImage(satFrame, data.satellite_url);
        mountImage(stvFrame, data.streetview_url);
        mountImage(katFrame, data.cadastre_url);

        // Texty a tabulky
        renderDetails(data);

        statusEl.textContent = 'Hotovo. Níže jsou obrázky a detaily.';
      } catch(err) {
        statusEl.className = 'error';
        statusEl.textContent = err.message;
      }
    });

    function mountImage(frame, url){
      frame.classList.remove('skeleton');
      frame.innerHTML = '';
      if(!url){ frame.textContent = 'Obrázek nedostupný'; return; }
      const img = new Image();
      img.src = url; img.loading = 'lazy'; img.alt = '';
      img.onerror = () => { frame.textContent = 'Obrázek se nepodařilo načíst'; };
      frame.appendChild(img);
    }

    function renderDetails(data){
      let html = '';
      if(data.souhrn){
        html += `<div class="section-title">Souhrn</div><div>${data.souhrn}</div>`;
      }
      if(data.identifikace_objektu){
        html += `<div class="section-title">Identifikace objektu</div><table>`;
        const obj = data.identifikace_objektu;
        html += row('Adresa', obj.adresa?.hodnota);
        html += row('Parcelní číslo', obj.parcelni_cislo?.hodnota);
        html += row('GPS', `Lat: ${obj.gps?.hodnota?.lat}, Lon: ${obj.gps?.hodnota?.lon}`);
        html += row('Typ stavby', obj.typ_stavby?.hodnota);
        html += row('Období výstavby', obj.rok_vystavby_obdobi?.hodnota);
        html += row('Počet nadzemních podlaží', obj.pocet_podlazi?.nadzemni);
        html += row('Stav budovy', obj.stav_budovy?.hodnota);
        html += `</table>`;
      }
      // případně doplníš konstrukce_technologie, statistické a lokalitu stejným stylem
      detailsEl.innerHTML = html;
    }
    function row(label, val){ return `<tr><th>${label}</th><td>${val ?? ''}</td></tr>`; }
  </script>
</body>
</html>
